{{/*  https://ballingt.com/observable-hugo-shortcode/  */}}
{{- $notebook := .Get "notebook" -}}
{{- $cellsRaw := .Get "cells" -}}
{{- $cellsArray := split $cellsRaw "," -}}
{{- $cellsClean := slice -}}
{{- range $cellsArray -}}
  {{ $cellsClean = $cellsClean | append (trim . "\n\r\t  ") -}}
{{- end -}}
{{- $cells := delimit $cellsClean "," -}}


<iframe
    frameborder="0"
    width="100%"
    src="https://observablehq.com/embed/{{- $notebook -}}?cells={{- $cells | safeURL -}}">
</iframe>

<script>
(function() {
  let s = document.querySelectorAll('script');
  let script = s[s.length - 1];
  let iframe = script.previousElementSibling;
  window.addEventListener("message", (e) => {
    if (e.origin === 'https://observablehq.com' && e.source === iframe.contentWindow) {
      const msg = JSON.parse(e.data);
      if (msg.context === 'iframe.resize') {
        iframe.height = msg.height;
      }
    }
  });
})();
</script>